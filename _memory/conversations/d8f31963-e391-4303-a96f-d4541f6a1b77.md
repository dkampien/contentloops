# v4 Template Development - Application Layer for Manual Workflow

## Context
Designed and built v4 comic book template (application layer) for manual workflow, focusing on cleaner structure, fixed block template approach, and reduced redundancy.

## Tracking Points

**Decision: Architecture Separation**
- Knowledge Layer (universal prompting) → System Prompt (CLAUDE.md)
- Application Layer (comic-specific workflow) → Template File (v4)
- Rationale: Avoid repeating framework in every template, maintain single source of truth

**Decision: Fixed Block Template Approach**
- Instead of choosing blocks per page, define all blocks upfront
- LLM fills what's relevant, skips what's not
- Simpler than selecting from library each time
- Story-wide blocks (set once): medium.type, layout, comicStyle
- Panel-level blocks (per panel): subjects.details, action, environment, shot.type, shot.angle, lighting

**Decision: Workflow Structure with Structured Elements**
- Each step uses relevant elements from: Task/Instructions, Rules/Constraints, Examples, Output Format
- Not every step needs all elements (pick what's useful)
- Use Markdown headings (###) + XML tags (<instructions>, <constraints>) for clear boundaries
- Based on OpenAI best practices for prompt engineering

**Discovery: Dependency Chain and Multi-Input**
- Step 2 panel moments → Step 3 block filling
- Added flexibility: Step 3 can reference Step 1 narrative for additional context if panel moments are sparse
- Avoids making Step 2 prompts too detailed (becoming prompt writing itself)

**Discovery: Redundancy Review Critical**
- Removed: Version Info, Structured Format explanation, Workflow Overview, Content Split, meta-explanations
- Kept: Architecture Notes, Key Definitions, Workflow Steps
- Trimmed redundancies within steps (word counts, format descriptions repeated)

**Status: v4 Template Complete**
- All 6 workflow steps built (Story Selection, Narrative, Page Planning, Prompt Generation, Thumbnail, Cleanup)
- Lean structure (~1100 tokens for skeleton, workflow steps added)
- Ready for testing

**Decision: Step 2 Layout Handling**
- Grid layout merged into story-wide blocks (typically 3 vertical panels)
- Not chosen per page (fixed story-wide)
- Removed from Step 2 instructions/output

**Decision: Character Definitions Format**
- Free text descriptions (not block-structured)
- Physical appearance only: hair, features, clothing
- Actions/props are panel-specific (in blocks)
- Copy character descriptions exactly into every panel

**Pattern: Seedream 4 Guidance**
- "Concise and precise prompts better than ornate vocabulary"
- Core structure: Subject + Action + Environment
- Natural language flow over attribute lists

**Open: System Prompt Optimization**
- Next phase: Extract knowledge layer from framework/guide
- Design tight system prompt for CLAUDE.md
- Identity/role concepts (e.g., "visual communicator, expert prompt engineer") go here

## Related Files/Artifacts
- Created: `_templates/comic-books/comic-books_template_v4.md`
- Updated: `_docs/1_development-docs/problem-solution-flow-map.md`
- Reference: `_docs/2_reference-docs/prompt-formula-framework-v2.md`
- Reference: `_docs/2_reference-docs/prompt-generation-guide-v5.md`
- Reference: `_docs/2_reference-docs/prompt-blocks.json`
- Reference: `_memory/cursor-notepads/# Seedream 4.md`
